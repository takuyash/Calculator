<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Windows 11風 電卓</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Win11.css CDN -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/Binaryify/Win11.css/dist/Win11.min.css"
  />
  <style>
    body {
      background: #f3f3f3;
      padding: 2rem;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .calculator {
      background: white;
      border-radius: 16px;
      box-shadow:
        0 2px 5px rgb(0 0 0 / 0.2),
        0 10px 20px rgb(0 0 0 / 0.1);
      width: 320px;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }
    .display {
      height: 60px;
      background: #eaeaea;
      border-radius: 12px;
      margin-bottom: 20px;
      padding: 10px 20px;
      font-size: 2rem;
      text-align: right;
      user-select: none;
      overflow-x: auto;
    }
    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }
    button {
      border: none;
      border-radius: 10px;
      padding: 15px 0;
      font-size: 1.2rem;
      font-weight: 600;
      background: #f3f3f3;
      box-shadow: inset 2px 2px 5px #ffffff,
                  inset -5px -5px 10px #d1d9e6;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    button:active {
      box-shadow: inset -2px -2px 5px #ffffff,
                  inset 5px 5px 10px #d1d9e6;
      background: #cbd6e7;
    }
    button.operator {
      background: #2563eb;
      color: white;
      box-shadow: 0 4px 6px #1e40af;
    }
    button.operator:active {
      background: #1e40af;
      box-shadow: 0 2px 3px #1e40af;
    }
  </style>
</head>
<body>
  <div class="calculator">
    <div id="display" class="display">0</div>
    <div class="buttons">
      <button data-action="clear">C</button>
      <button data-action="delete">DEL</button>
      <button data-action="percent">%</button>
      <button data-action="divide" class="operator">÷</button>

      <button data-number="7">7</button>
      <button data-number="8">8</button>
      <button data-number="9">9</button>
      <button data-action="multiply" class="operator">×</button>

      <button data-number="4">4</button>
      <button data-number="5">5</button>
      <button data-number="6">6</button>
      <button data-action="subtract" class="operator">−</button>

      <button data-number="1">1</button>
      <button data-number="2">2</button>
      <button data-number="3">3</button>
      <button data-action="add" class="operator">＋</button>

      <button data-number="0" style="grid-column: span 2;">0</button>
      <button data-number=".">.</button>
      <button data-action="equals" class="operator">=</button>
    </div>
  </div>

  <script>
    (() => {
      const display = document.getElementById("display");
      let current = "0";
      let previous = null;
      let operator = null;
      let resetNext = false;

      function updateDisplay() {
        display.textContent = current;
      }

      function clear() {
        current = "0";
        previous = null;
        operator = null;
        resetNext = false;
        updateDisplay();
      }

      function deleteLast() {
        if (resetNext) return;
        if (current.length > 1) {
          current = current.slice(0, -1);
        } else {
          current = "0";
        }
        updateDisplay();
      }

      function appendNumber(num) {
        if (resetNext) {
          current = num;
          resetNext = false;
        } else {
          if (current === "0" && num !== ".") {
            current = num;
          } else {
            if (num === "." && current.includes(".")) return;
            current += num;
          }
        }
        updateDisplay();
      }

      function chooseOperator(op) {
        if (operator !== null) compute();
        previous = current;
        operator = op;
        resetNext = true;
      }

      function compute() {
        if (operator === null || resetNext) return;
        let prev = parseFloat(previous);
        let curr = parseFloat(current);
        if (isNaN(prev) || isNaN(curr)) return;
        let result = 0;
        switch (operator) {
          case "add":
            result = prev + curr;
            break;
          case "subtract":
            result = prev - curr;
            break;
          case "multiply":
            result = prev * curr;
            break;
          case "divide":
            if (curr === 0) {
              alert("0で割ることはできません");
              clear();
              return;
            }
            result = prev / curr;
            break;
        }
        current = result.toString();
        operator = null;
        previous = null;
        resetNext = true;
        updateDisplay();
      }

      function percent() {
        let curr = parseFloat(current);
        if (isNaN(curr)) return;
        current = (curr / 100).toString();
        updateDisplay();
      }

      document.querySelectorAll("button").forEach((btn) => {
        btn.addEventListener("click", () => {
          const number = btn.getAttribute("data-number");
          const action = btn.getAttribute("data-action");

          if (number !== null) {
            appendNumber(number);
          } else if (action !== null) {
            switch (action) {
              case "clear":
                clear();
                break;
              case "delete":
                deleteLast();
                break;
              case "percent":
                percent();
                break;
              case "add":
              case "subtract":
              case "multiply":
              case "divide":
                chooseOperator(action);
                break;
              case "equals":
                compute();
                break;
            }
          }
        });
      });

      updateDisplay();
    })();
  </script>
</body>
</html>
